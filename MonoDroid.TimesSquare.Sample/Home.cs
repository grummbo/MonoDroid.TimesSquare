using System;
using System.Collections.Generic;
using Android.App;
using Android.Content;
using Android.Content.PM;
using Android.OS;
using Android.Views;
using Android.Widget;

namespace MonoDroid.TimesSquare.Sample
{
    [Activity(Label = "MonoDroid.TimesSquare.Sample", MainLauncher = true,
        ConfigurationChanges = ConfigChanges.Orientation | ConfigChanges.KeyboardHidden)]
    public class Home : Activity
    {
        private const string TAG = "MonoDroid.TimesSquare.Sample";

        protected override void OnCreate(Bundle bundle)
        {
            base.OnCreate(bundle);

            SetContentView(Resource.Layout.calendar_picker);

            var nextYear = DateTime.Now.AddYears(1);

            var calendar = FindViewById<CalendarPickerView>(Resource.Id.calendar_view);
            calendar.Init(DateTime.Now, nextYear)
                .InMode(CalendarPickerView.SelectionMode.Single)
                .WithSelectedDate(DateTime.Now)
                .WithHighlightedDate(DateTime.Now.AddDays(2));

            calendar.OnDateSelected +=
                (s, e) => Toast.MakeText(this, e.SelectedDate.ToShortDateString(), ToastLength.Short).Show();

            var btnSingle = FindViewById<Button>(Resource.Id.button_single);
            var btnMulti = FindViewById<Button>(Resource.Id.button_multi);
            var btnRange = FindViewById<Button>(Resource.Id.button_range);
            var btnDialog = FindViewById<Button>(Resource.Id.button_dialog);

            btnSingle.Click += (s, e) =>
            {
                btnSingle.Enabled = false;
                btnMulti.Enabled = true;
                btnRange.Enabled = true;

                calendar.Init(DateTime.Now, nextYear)
                    .InMode(CalendarPickerView.SelectionMode.Single)
                    .WithSelectedDate(DateTime.Now);
            };

            btnMulti.Click += (s, e) =>
            {
                btnSingle.Enabled = true;
                btnMulti.Enabled = false;
                btnRange.Enabled = true;

                var dates = new List<DateTime>();
                for (int i = 0; i < 5; i++)
                {
                    dates.Add(DateTime.Now.AddDays(3 * i));
                }
                calendar.Init(DateTime.Now, nextYear)
                    .InMode(CalendarPickerView.SelectionMode.Multi)
                    .WithSelectedDates(dates);
            };

            btnRange.Click += (s, e) =>
            {
                btnSingle.Enabled = true;
                btnMulti.Enabled = true;
                btnRange.Enabled = false;

                var dates = new List<DateTime>() { DateTime.Now.AddDays(3), DateTime.Now.AddDays(5) };
                calendar.Init(DateTime.Now, nextYear)
                    .InMode(CalendarPickerView.SelectionMode.Range)
                    .WithSelectedDates(dates);
            };

            btnDialog.Click += (s, e) =>
            {
                var dialogView =
                    (CalendarPickerView)LayoutInflater.Inflate(Resource.Layout.dialog, null, false);
                dialogView.Init(DateTime.Now, nextYear);
                new AlertDialog.Builder(this).SetTitle("I'm a dialog!")
                    .SetView(dialogView)
                    .SetNeutralButton("Dismiss",
                    (sender, args) =>
                    {
                    }).Create().Show();
            };

            FindViewById<Button>(Resource.Id.done_button).Click += (s, o) =>
            {
                calendar = FindViewById<CalendarPickerView>(Resource.Id.calendar_view);
                Logr.D(TAG, "Selected time in millis: " + calendar.SelectedDate);
                string toast = "Selected: " + calendar.SelectedDate;
                Toast.MakeText(this, toast, ToastLength.Short).Show();
            };
        }
    }
}


